## 消息页面接口文档

---

## 1. 获取消息列表（分页）

### 请求信息

- **接口地址**：`/api/app/v1/message/list`
- **请求方式**：GET
- **接口说明**：获取当前用户的消息列表，支持分页，用于「消息」页面展示。

#### 请求参数（Query）

| 参数名     | 类型   | 必填 | 说明                |
| ---------- | ------ | ---- | ------------------- |
| page       | number | 是   | 当前页码，从 1 开始 |
| pageSize   | number | 是   | 每页条数            |

> 说明：分页参数与项目中 `PageParams` 统一。

### 响应数据

#### 成功响应

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "type": "赞和收藏",
        "detail": "叮当 点赞了您",
        "time": "3分钟前",
        "avatar": "https://example.com/avatar1.jpg",
        "count": 2
      },
      {
        "id": 2,
        "type": "评论我的",
        "detail": "叮当：我喜欢你这有趣的分享",
        "time": "昨天",
        "avatar": "https://example.com/avatar2.jpg",
        "count": 1
      },
      {
        "id": 3,
        "type": "小秘书",
        "detail": "积分变动 获得2积分",
        "time": "2天前",
        "avatar": "https://example.com/avatar3.jpg",
        "count": 0
      }
    ],
    "total": 30,
    "page": 1,
    "pageSize": 10
  }
}
```

#### 字段说明

**data 对象：分页结构**

| 字段名   | 类型   | 说明               |
| -------- | ------ | ------------------ |
| list     | array  | 消息列表           |
| total    | number | 总条数             |
| page     | number | 当前页码           |
| pageSize | number | 每页条数           |

**list 数组元素（单条消息对象）：**

| 字段名 | 类型   | 说明 |
|--------|--------|------|
| id     | number | 消息ID，唯一标识 |
| type   | string | 消息类型名称，如「赞和收藏」「评论我的」「小秘书」「关注我的」等 |
| detail | string | 消息内容摘要，展示在列表中的一行文案 |
| time   | string | 时间文案，如「3分钟前」「昨天」「2024-01-01 12:00」等，由后端组装好 |
| avatar | string | 头像图片 URL（例如产生该消息的用户头像或系统头像） |
| count  | number | （可选）未读数量或该类型下未读条数；>0 时前端在头像右上角显示角标，>99 时前端显示为 "99+" |

---

## 2. 全部标为已读

### 请求信息

- **接口地址**：`/api/app/v1/message/read-all`
- **请求方式**：POST
- **接口说明**：将当前用户的所有未读消息标记为已读，对应「消息」页面右上角「全部已读」按钮。

#### 请求参数

| 位置   | 参数名 | 类型 | 必填 | 说明 |
|--------|--------|------|------|------|
| Body   | 无     | -    | -    | 无请求体 |
| Query  | 无     | -    | -    | 无 Query 参数 |

### 响应数据

#### 成功响应

```json
{
  "code": 200,
  "message": "success",
  "data": null
}
```

> 说明：`data` 可为 `null` 或空对象 `{}`，前端仅根据 `code` 判断成功与否，成功后会重新拉取消息列表。

#### 字段说明

| 字段名  | 类型   | 说明                           |
|---------|--------|--------------------------------|
| code    | number | 状态码，成功建议返回 200 或 0  |
| message | string | 提示信息，如 "success"        |
| data    | any    | 此接口无业务数据，固定为 null 或 {} |

---

## 通用说明

### 错误响应示例

```json
{
  "code": 500,
  "message": "服务器错误",
  "data": null
}
```

### 常见错误码

| 错误码 | 说明           |
|--------|----------------|
| 200    | 成功           |
| 0      | 成功（如采用 0 表示成功的风格） |
| 400    | 请求参数错误   |
| 401    | 未授权 / 登录失效 |
| 404    | 资源不存在     |
| 500    | 服务器内部错误 |

### 其他约定

1. 所有接口返回的图片 URL 建议为完整的 HTTPS 地址，便于前端直接使用。
2. 时间字段（如 `time`）由后端组装成人类可读字符串，前端不再做格式化。
3. `count` 字段缺省或为 0 时视为无未读，不显示角标。

## 消息模块接口文档

### 1. 获取消息列表（分页）

- **接口路径**：`GET /api/app/v1/message/list`
- **接口说明**：获取当前用户的消息列表，支持分页，给 `消息` 页面使用（`/pages/message/message`）。

#### 1.1 请求参数（Query）

| 参数名      | 类型   | 是否必填 | 说明                     |
| ----------- | ------ | -------- | ------------------------ |
| `page`      | number | 是       | 当前页码，从 1 开始      |
| `pageSize`  | number | 是       | 每页条数                 |

> 说明：分页参数与项目中 `PageParams` 保持一致，前端使用 `z-paging` 组件驱动分页。

#### 1.2 响应结果

统一使用项目中的分页返回结构 `PageResult<IMessageItem>`：

```ts
interface PageResult<T> {
  list: T[]
  total: number
  page: number
  pageSize: number
}

interface IMessageItem {
  id: number
  /** 消息类型文案，如：赞和收藏 / 评论我的 / 小秘书 / 关注我的 */
  type: string
  /** 消息详情文案（列表中的一行说明） */
  detail: string
  /** 时间文案，如：3分钟前 / 昨天 / 2024-01-01 12:00 */
  time: string
  /** 头像地址 URL */
  avatar: string
  /**
   * 未读数量（或该类型下未读消息条数）
   * 有值且 > 0 时，前端在头像右上角显示角标；
   * 当 count > 99 时，前端显示为 "99+"。
   */
  count?: number
}
```

#### 1.3 前端使用说明

- 调用封装函数：`getMessageList(params: IGetMessageListParams)`（定义于 `src/api/message.ts`）。
- `z-paging` 回调中逻辑：
  - 计算是否为最后一页：`isLastPage = page * pageSize >= total`；
  - 调用：`paging.complete(list, isLastPage)`。

> 只要后端保证 `total` 为总条数，前端即可正确计算是否还有更多页。

---

### 2. 全部标为已读

- **接口路径**：`POST /api/app/v1/message/read-all`
- **接口说明**：将当前用户的所有未读消息标记为已读，用于消息页面右上角「全部已读」按钮。

#### 2.1 请求参数

- **请求体**：无
- **Query**：无

#### 2.2 响应结果

采用项目统一响应结构 `IResponse<void>`（参考 `src/http/types.ts`），示例：

```json
{
  "code": 0,
  "data": null,
  "msg": "ok"
}
```

- 建议：
  - 成功时，`code` 使用项目认可的成功码（如 `0` 或 `200`），以兼容 `http.ts` 中的业务判断。
  - 错误时，返回合适的 `msg` / `message` 字段，前端会用 Toast 进行提示。

#### 2.3 前端使用说明

- 调用封装函数：`markAllMessagesRead()`（定义于 `src/api/message.ts`）。
- 成功后前端会：
  - 调用 `paging.reload()` 重新拉取第一页数据；
  - 弹出 `uni.showToast({ title: '已全部标为已读', icon: 'none' })` 提示用户。

---

### 3. 对接建议

- 如需扩展功能（可选）：
  - 单条消息点击后标记为已读：可增加 `POST /api/app/v1/message/read`，入参如 `{ id: number }`。
  - 区分不同消息类型 tab：可在列表接口增加 `type` 参数（如 `system` / `comment` / `like` 等）。
  - 顶部红点汇总：可增加 `GET /api/app/v1/message/unread-summary`，返回当前未读总数或按类型统计。


